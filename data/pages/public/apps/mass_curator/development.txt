====== Mass Curator: Developer Information ======

The Mass Curator tool is developed using JRuby((http://jruby.org)) (v 1.5.1) and is licenced under [[http://www.gnu.org/licenses/gpl.html|GPL 3]].

This project utilizes BioCatalogue's read API to GET all the services, and the write API to POST the annotations data.

**IMPORTANT**
  * The project was only put into testing under the Mac OS X platform (10.5).  Testing on other platforms is **required**.
  * Only Excel 97-2004 workbooks (.xls) are currently supported.
===== Building Mass Curator =====

The source code for this project is hosted on GitHub at http://github.com/myGrid/BioCatalogue-Mass-Curator

To build the project locally, checkout a copy of the the source code from the repository by running ''%%git clone git://github.com/myGrid/BioCatalogue-Mass-Curator.git%%''

The packaging for this tool is handled by the JRuby gem - RAWR((http://rawr.rubyforge.org)).  To install this, run ''sudo jruby -S gem install rawr''

Mass Curator is dependant on the following libraries (all of which are included in the source's ''lib'' folder as JAR archives).
  * ''BrowserLauncher'' ((http://browserlaunch2.sourceforge.net)) (Java library)
  * ''spreadsheet'' ((http://spreadsheet.rubyforge.org)) (JRuby gem)
  * ''parseconfig'' ((http://rubyforge.org/projects/parseconfig)) (JRuby gem)
  * ''libxml-jruby'' ((http://github.com/dylanvaughn/libxml-jruby)) (JRuby gem)
  * ''json-jruby'' ((http://json-jruby.rubyforge.org)) (JRuby gem)


The application's configuration is done via a ''mass-curator.conf'' file.  This needs to be placed in the directory you wish to run the application from.  If no ''mass-curator.conf'' file is found, the default settings will be used, but they will not be saved.  To use the default settings and allow for the preferences to be saved, place an empty ''mass-curator.conf'' file in the application's directory.  You can also specify your own settings by placing something like this into the file: ((A full list of configuration options will be made available soon))
  [application]
  biocatalogue-hostname = "http://sandbox.biocatalogue.org"
  services-per-page = 15
  search-results-per-page = 10
  
  [spreadsheet]
  include-help = false

If you wish to run the application using the uncompiled source, run the command ''./run-dev.sh'' from your working directory.

To build an executable JAR archive, run ''rake rawr:jar'' from your working directory.  Make sure you are using the JRuby version of ''rake'', otherwise the build will fail.  //There is no need to run ''rawr install'' as the configuration files come as part of the source.//

To execute the created JAR from the top level working directory, run ''java -jar package/jar/BioCatalogue-Mass-Curator.jar''

For a complete list of commands, run ''rake -T''

===== Project Format =====

The code for the project is structured in the following manner:
  * ''project root''
    * ''lib'' //(contains all the Java libraries and gems required in JARs)//
    * ''resources'' //(contains all the images and other data resources)//
    * ''package'' //(where all the builds go by default, this is exempt from source control)//
    * ''src'' //(contains the actual code to drive the application)//
      * ''events'' //(where event handlers and action listeners live)//
      * ''models'' //(the data models used by the application such as ''Service'')//
      * ''modules'' //(common code used by the application, e.g error handling and logging, error/information dialogs, etc)//
      * ''org'' //(the is where the RAWR autogenerated application launcher file lives)//
      * ''ui'' //(all of the user interface components i.e. panels and windows)//

Apart for the ''run-dev.sh'' script, the ''Licence'', and the ''ReadMe.rdoc'' file, the top level of the ''project root'' contains 2 other files of interest: ''build_configuration.rb'' and ''Rakefile''.  These 2 files are used by RAWR, together with ''src/org/rubyforge/rawr/Main.rb'' to drive the builds and execution of the compiled binaries.

The top level of the ''src'' directory contains 3 important files: ''main.rb'', ''application_requires.rb'' and ''application_constants.rb''; ''main.rb'' serves as an entry point for the program, ''application_constants.rb'' declares which files and classes are needed by the application, and ''application_requires.rb'' does the actual loading of the JRuby application, libraries, and user configuration settings into memory.  Mass Curator uses eager loading for Java classes.  Lazy loading the Java classes increases the startup time by only a fraction of a second;  loading of all classes before hand, allows for slightly cleaner and manageable code.  As far as application events go, loading is done as needed.

Logging facilities are provided by the logger from Ruby's core library, writing to ''mass-curator.log'' which appears in the same directory as the running instance.  For development purposes, the log's output can be redirected to the standard output (console) by providing the executable with the argument ''--log-to-stdout'' before launch (see ''run-dev.sh'').

===== Data Model and Relationships =====

Mass Curator's data model consists of 3 objects: ''Service'', ''ServiceComponent'', and ''ServiceComponentIO''.  ''Service'' is analogous to the ''Service'' model in the BioCatalogue.  Each ''Service'' has a collection of ''ServiceComponent''s in the form of a hash mapping ''id'' => ''ServiceComponent''.  A ''ServiceComponent'' is analogous to a BioCatalogue SOAP operation and a REST endpoint((not currently implemented)).  A ''ServiceComponent'' contains hashes for the "inputs" and "outputs", both mapping ''id'' to ''ServiceComponentIO''.  ''ServiceComponentIO'' is anagolous to SOAP inputs, SOAP outputs, and REST input parameters((not currently implemented)) in the BioCatalogue.

''Service''s are only created as needed, and likewise for ''ServiceComponent''s and ''ServiceComponentIO''s.  When an API call is made to the BioCatalogue to retrieve some services, only the ''Service'' object is instantiated.  The ''Service'' model has a ''fetchComponents'' method, which will instantiate and build the relationships between the objects in the data model tree.  Each model tree contains a list of ''descriptions''; this list is also populated when ''fetchComponents'' is called.

===== Caching =====

''Services'' are cached, and the cache is frequently updated to contain all the information available about that service; if ''Service#fetchComponents'' is called, the cached ''Service'' will contain all the descriptions and the relationships, otherwise it will just be the ''Service'' entry with the basic information.  The instance method ''fetchComponents'' is usually called when exporting ''Service''s to a spreadsheet.  Caches have been implemented for the service browser and the current search results; a cache for all searches made may be required.