===== Test Scripts in BioCatalogue =====
==== What Are Test Scripts? ====

Test scripts are simple clients to web services which can be uploaded to the BioCatalogue to be run by the BioCatalogue system. The purpose of the test scripts is double fold:
  * they provide the users  with an example client of how to use the service
  * they enable the biocatalogue system to monitor the status of the service by running these sample clients regularly

==== Who Can Submit a Test Script? ====

Only those that have full permissions on services to BioCatalogue are able to submit test scripts as well. They can only submit test scripts against the services which they registered or are responsible for. You can check your user profile on BioCatalogue to see the services you submitted or are responsible for.

==== What Kinds of Scripts are Allowed? ====

Test script should be written in one of the following scripting languages:
  * perl
  * python
  * ruby

BioCatalogue is also able to run [[http://www.soapui.org/|soapUI]] project files. These are xml files that can be generated by building test cases with the [[http://www.soapui.org/|soapUI]] framework.
==== What is the Specification of the Test Scripts? ====

Test scripts should have the following properties:
  * Test script files should be executable on the command line and should take no arguments.
  * Test scripts should **always** exit with a status code which determines whether the test passed or not.  This code is an integer between 0 and 255 (inclusive) where 0 indicates successful execution. 
  * If a script requires other files, these files should supplied with the script. These can be uploaded as a zip archive
  * Execution time for script should not be more than an hour. Script will be terminated if they exceed this max allowed time


==== Will Scripts be available for running immediately upon Submission? ====

 Yes. However, newly submitted scripts will be  schedule for the next run of the monitoring framework. The BioCatalogue administrators however reserve the right to deactivate any tests if they are deemed to be unsuitable for the monitoring purpose. 
==== Which libraries does BioCatalogue Support? ====

**Perl**

The main module needed for WSDL services include :

  * XML::LibXML
  * XML::Compile version 1.07
  * XML::Compile::WSDL11 version 2.08
  * XML::Compile::SOAP11 version 2.08

**Python**

  * PyXML version 0.8.4
  * fpconst version 0.7.2
  * ZSI version 2.1
  * SOAPpy version 0.12.0
  * MySQLdb

**Ruby**

  * ruby version 1.8.6

==== Example ====

=== Perl ===

Sample perl client for the [[http://www.biocatalogue.org/services/106|EMBOSS showfeat ]] service in BioCatalogue. 

<code>

#!/usr/bin/perl

use XML::Compile::SOAP11;
use XML::Compile::WSDL11;
use XML::Compile::Transport::SOAPHTTP;
use strict;

####

eval {

	my $inputs = {
		'sequence' => { 'usa' => 'embl:X65921'}
	};

	my $serviceendpoint =
	  'http://www.ebi.ac.uk/soaplab/typed/services/display.showfeat';

	print "Retriving and processing the WSDL and the XSDs imported\n";
	my $wsdl  = XML::LibXML->new->parse_file( $serviceendpoint . '?wsdl' );
	my $proxy = XML::Compile::WSDL11->new($wsdl);
	foreach my $schema ( 1, 2, 3 ) {
		my $xsdXml =
		  XML::LibXML->new->parse_file( $serviceendpoint . '?xsd=' . $schema );
		if($XML::Compile::SOAP::VERSION < 2.0)
		{
			$proxy->schemas->importDefinitions($xsdXml);
		}
		else
		{
			$proxy->importDefinitions($xsdXml);
		}
	}

	print "Preparing caller object for runAndWaitFor operation\n";
	my $runAndWaitFor = $proxy->compileClient('runAndWaitFor');

	print "Calling the service and getting the response\n";
	my ( $answer, $trace ) = $runAndWaitFor->( $inputs );

	# &printTrace($trace);

	my %answer = %{$answer};
	my %answer_ = %{ $answer{'runAndWaitForResponse'} };
	my $report = $answer_{'report'};
	my $detailed_status = $answer_{'detailed_status'};
	my $outfile = $answer_{'outfile'};
	my $outfile_url = $answer_{'outfile_url'};


	print "\nSoaplab report received:\n----------------------------\n\n$report\n";

	if ( $detailed_status == 0 ) {
		print "Passed\n";
		exit 0;
	}

	print "Failed\n";
	exit 1;
};

if ($@) {
	print "Caught an exception\n" . $@;
	exit 1;
}

# Print request/response trace
sub printTrace($) {
	my $trace = shift;
	$trace->printTimings;
	$trace->printRequest;
	$trace->printResponse;
}

# File to String
sub file2String($) {
	my $fname = shift;
	open FILE, $fname or die "Couldn't open file: $!";
	my $fcontent = join( "", <FILE> );
	close FILE;
	return $fcontent;
}


</code>


==== References ====

  * [[http://www.embraceregistry.net/documentation|Embrace Registry Documentation]]
  * [[http://www.soapui.org/|soapUI Web Services Testing Framework]]
  